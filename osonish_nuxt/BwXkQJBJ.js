import{p as y,h as k,E as Q,Z as X,o as B,c as K,a as Y,m as tt,t as et,C as rt,q as M}from"./BK2JPfx8.js";const nt={class:"tahrirchi-input-wrapper"},at=["data-input-id","contenteditable","data-placeholder"],it={key:0,class:"tahrirchi-error-hint"},ot={__name:"TahrirchiInput",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Matnni kiriting"},inputId:{type:String,default:null},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(m,{expose:q,emit:N}){const i=m,w=N,A=y(i.inputId||`tahrirchi-${globalThis.crypto?.randomUUID?.()||Math.random().toString(36).slice(2)}`),a=y(null),u=y(""),s=y(0),V=y(!1),R=()=>s.value,D=M(()=>s.value>0),O=M(()=>s.value>0&&!!u.value);let S=!1,U=null,g="",x=null,C=null,T=null,v=null,p=null,I=null;const H=()=>(a.value?.textContent||"").trim(),E=t=>{if(!t)return!1;const e=window.getComputedStyle(t);return!(e.display==="none"||e.visibility==="hidden"||e.opacity==="0"||t.hasAttribute("aria-hidden")&&t.getAttribute("aria-hidden")==="true")},z=(t,e)=>{const r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),o=r.left+r.width/2,c=r.top+r.height/2,l=n.left+n.width/2,h=n.top+n.height/2;return Math.hypot(o-l,c-h)},P=()=>{if(!a.value)return null;let t=a.value;for(let c=0;c<8&&t;c++){const l=t.querySelector?.(".tahrirchi-icon-button_error");if(l&&E(l))return I=t,l;t=t.parentElement}const e=a.value.closest(".el-form-item");if(!e)return null;const r=Array.from(e.querySelectorAll(".tahrirchi-icon-button_error")).filter(E);if(!r.length)return null;let n=null,o=1/0;return r.forEach(c=>{const l=z(a.value,c);l<o&&(o=l,n=c)}),!n||o>180?null:(I=e,n)},j=t=>{if(!t||!E(t))return 0;const e=Number(t.getAttribute("data-error-count"));if(!Number.isNaN(e)&&e>0)return e;const n=Array.from(t.attributes||[]).map(_=>_.value).join(" ").match(/\d+/);if(n)return parseInt(n[0],10);const o=t.getAttribute("aria-label")||"",c=t.getAttribute("title")||"",l=(o+" "+c).match(/\d+/);if(l)return parseInt(l[0],10);const h=t.querySelectorAll('.tahrirchi-badge, .badge, [class*="badge"], [class*="count"], [class*="number"], span');for(const _ of h){const L=(_.textContent||"").trim().match(/\d+/);if(L)return parseInt(L[0],10)}const b=(t.textContent||"").trim().match(/\d+/);return b?parseInt(b[0],10):t.classList.contains("tahrirchi-icon-button_error")?1:0},d=()=>{if(!H()){s.value=0,u.value="";return}const e=P();if(!e){s.value=0,u.value="";return}const r=j(e);if(!r){s.value=0,u.value="";return}s.value=r,u.value=`Imlo xatolari: ${r}`},F=()=>{if(!a.value)return;const t=a.value.closest(".el-form-item"),e=I||t;e&&(p&&p.disconnect(),p=new MutationObserver(()=>{requestAnimationFrame(()=>{setTimeout(()=>d(),60)})}),p.observe(e,{childList:!0,characterData:!0,subtree:!0,attributes:!0}))},W=t=>{if(i.disabled)return;let e=t.target.textContent||"";if(!S&&e.length===1&&e[0]!==e[0].toUpperCase()){e=e.toUpperCase();const r=window.getSelection();t.target.textContent=e;try{const n=t.target.firstChild;if(n){const o=document.createRange();o.setStart(n,1),o.setEnd(n,1),r.removeAllRanges(),r.addRange(o)}}catch{}S=!0}e!==i.modelValue&&(w("update:modelValue",e),window.tahrirchiLastKnownText!==void 0&&(window.tahrirchiLastKnownText=e)),e.trim().length===0&&(S=!1,u.value="",s.value=0,V.value=!1),v&&clearTimeout(v),v=setTimeout(()=>{d()},300)},$=t=>{if(i.disabled)return;const e=t.target.textContent||"";w("update:modelValue",e),window.tahrirchiLastKnownText!==void 0&&(window.tahrirchiLastKnownText=e),setTimeout(()=>d(),100)},Z=t=>{i.disabled||(t.key==="Enter"&&t.preventDefault(),t.key==="Escape"&&document.querySelectorAll('[class*="tahrirchi-card"], [class*="tahrirchi-popup"]').forEach(r=>{r&&r.style&&(r.style.display="none",r.remove?.())}))},G=()=>{i.disabled||window.Tahrirchi&&a.value&&setTimeout(()=>{try{i.modelValue&&(a.value.textContent=i.modelValue,g=i.modelValue),window.tahrirchiLastKnownText=g,a.value.setAttribute("data-tahrirchi-input-id",A.value),U=new window.Tahrirchi.SpellChecker({container:a.value,api_key:"th_85fe9c83-06eb-4b08-aa61-e0566a904ad2"}),setTimeout(()=>{d(),F(),d()},1500);const t=()=>{if(a.value){const e=a.value.textContent||"";e!==i.modelValue&&(w("update:modelValue",e),g=e,window.tahrirchiLastKnownText=e)}};x=new MutationObserver(()=>t()),x.observe(a.value,{childList:!0,characterData:!0,subtree:!0}),C=e=>{const r=e.target,n=document.querySelectorAll('[class*="tahrirchi-card"], [class*="tahrirchi"][class*="popup"], .tahrirchi-suggestions');if(!Array.from(n).find(h=>{const f=window.getComputedStyle(h);return f.display!=="none"&&f.visibility!=="hidden"&&h.offsetParent!==null}))return;const c=r.closest('[class*="tahrirchi"]')!==null||r.classList?.toString().includes("tahrirchi");if(r.closest(".tahrirchi-card__word")||r.closest('[class*="tahrirchi-word"]')){setTimeout(()=>d(),200);return}c||Array.from(n).filter(f=>{const b=window.getComputedStyle(f);return b.display!=="none"&&b.visibility!=="hidden"}).forEach(f=>{f.style.display="none"})},document.addEventListener("click",C,!0),T=e=>{e.key==="Escape"&&document.querySelectorAll('[class*="tahrirchi-card"], [class*="tahrirchi-popup"], [id*="tahrirchi"]').forEach(n=>{n&&n.style&&(n.style.display="none",n.remove?.())})},document.addEventListener("keydown",T,!0)}catch(t){console.error("âŒ Tahrirchi initialization error:",t)}},500)},J=t=>{contentEditableRef.value&&(contentEditableRef.value.textContent=t,window.tahrirchiLastKnownText!==void 0&&(window.tahrirchiLastKnownText=t),w("update:modelValue",t))};return k(()=>i.modelValue,t=>{a.value&&t!==a.value.textContent&&(a.value.textContent=t,g=t,!t||t.trim()===""?(s.value=0,u.value="",V.value=!1):setTimeout(()=>d(),80))}),k(()=>i.disabled,t=>{t&&(s.value=0,u.value="",V.value=!1)}),Q(()=>{i.disabled&&i.modelValue&&a.value&&(a.value.textContent=i.modelValue),G()}),X(()=>{x&&x.disconnect(),p&&p.disconnect(),C&&document.removeEventListener("click",C,!0),T&&document.removeEventListener("keydown",T,!0),v&&clearTimeout(v)}),q({hasError:D,getErrorCount:R,errorCount:s,setText:J,focus:()=>a.value?.focus()}),(t,e)=>(B(),K("div",nt,[Y("div",{ref_key:"inputContainer",ref:a,"data-input-id":A.value,contenteditable:!m.disabled,onInput:W,onBlur:$,onKeydown:Z,class:tt(["title-input-editable",{"is-disabled":m.disabled}]),"data-placeholder":m.modelValue?"":m.placeholder},null,42,at),O.value?(B(),K("div",it,et(u.value),1)):rt("",!0)]))}},ct=Object.assign(ot,{__name:"TahrirchiInput"});export{ct as _};
