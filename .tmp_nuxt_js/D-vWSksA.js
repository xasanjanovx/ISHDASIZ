import{D as De,s as P,i as O,aI as Ie,e as Te,aU as Ae,g as Fe,B as Ve,Z as Be,E as _e,o as E,j as Pe,w as g,a as X,k as a,n as Y,m as $,b as T,I as x,a_ as Oe,l as m,c as S,L as ee,C as te,G as Ke,H as Me,d as Re,t as Ue,q as w,p as v,R as K,b5 as He}from"./BK2JPfx8.js";import{b as Le,d as ae,_ as We,$ as qe,E as je,l as ze,J as Ge,K as f,w as Je}from"./Q0Uepi9K.js";import{i as oe,E as Ze}from"./CL3hsE-Z.js";import{E as Qe}from"./BRVkaU9v.js";import{u as A,a as Xe}from"./B6ZCCVaR.js";import{C as le,I as M,U as F,t as Ye}from"./BE20p1dL.js";import{c as xe}from"./DRYPtbMC.js";import{p as et}from"./BHWYNUKH.js";const tt=Le({...oe,valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:ae(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:ae([Function,Array]),default:Ie},popperClass:A.popperClass,popperStyle:A.popperStyle,triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:Boolean,hideLoading:Boolean,teleported:A.teleported,appendTo:A.appendTo,highlightFirstItem:Boolean,fitInputWidth:Boolean,loopNavigation:{type:Boolean,default:!0}}),at={[F]:l=>P(l)||O(l),[M]:l=>P(l)||O(l),[le]:l=>P(l)||O(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent,clear:()=>!0,select:l=>De(l)},st=["aria-expanded","aria-owns"],ot={key:0},lt=["id","aria-selected","onClick"],se="ElAutocomplete",nt=Te({name:se,inheritAttrs:!1,__name:"autocomplete",props:tt,emits:at,setup(l,{expose:ne,emit:re}){const o=l,p=re,ue=w(()=>et(o,Object.keys(oe))),ie=Ae(),R=xe(),u=Fe("autocomplete"),c=v(),U=v(),N=v(),H=v();let L=!1,V=!1;const r=v([]),s=v(-1),W=v(""),d=v(!1),D=v(!1),y=v(!1),k=Ve(),pe=w(()=>ie.style),h=w(()=>(r.value.length>0||y.value)&&d.value),q=w(()=>!o.hideLoading&&y.value),ce=w(()=>c.value?Array.from(c.value.$el.querySelectorAll("input")):[]),de=()=>{h.value&&(W.value=`${c.value.$el.offsetWidth}px`)},ve=()=>{s.value=-1},j=async e=>{if(D.value)return;const t=n=>{y.value=!1,!D.value&&(K(n)?(r.value=n,s.value=o.highlightFirstItem?0:-1):Ye(se,"autocomplete suggestions must be an array"))};if(y.value=!0,K(o.fetchSuggestions))t(o.fetchSuggestions);else{const n=await o.fetchSuggestions(e,t);K(n)&&t(n)}},fe=w(()=>o.debounce),B=He(j,fe),ge=e=>{const t=!!e;if(p(M,e),p(F,e),D.value=!1,d.value||(d.value=t),!o.triggerOnFocus&&!e){D.value=!0,r.value=[];return}B(e)},me=e=>{var t;R.value||(((t=e.target)==null?void 0:t.tagName)!=="INPUT"||ce.value.includes(document.activeElement))&&(d.value=!0)},he=e=>{p(le,e)},be=e=>{var t;if(V)V=!1;else{d.value=!0,p("focus",e);const n=(t=o.modelValue)!=null?t:"";o.triggerOnFocus&&!L&&B(String(n))}},ye=e=>{setTimeout(()=>{var t;if((t=N.value)!=null&&t.isFocusInsideContent()){V=!0;return}d.value&&C(),p("blur",e)})},ke=()=>{d.value=!1,p(F,""),p("clear")},z=async()=>{var e;(e=c.value)!=null&&e.isComposing||(h.value&&s.value>=0&&s.value<r.value.length?_(r.value[s.value]):(o.selectWhenUnmatched&&(p("select",{value:o.modelValue}),r.value=[],s.value=-1),d.value=!0,B(String(o.modelValue))))},Ee=e=>{h.value&&(e.preventDefault(),e.stopPropagation(),C())},C=()=>{d.value=!1},$e=()=>{var e;(e=c.value)==null||e.focus()},we=()=>{var e;(e=c.value)==null||e.blur()},_=async e=>{p(M,e[o.valueKey]),p(F,e[o.valueKey]),p("select",e),r.value=[],s.value=-1},b=e=>{var t,n;if(!h.value||y.value)return;if(e<0){if(!o.loopNavigation){s.value=-1;return}e=r.value.length-1}e>=r.value.length&&(e=o.loopNavigation?0:r.value.length-1);const[i,J]=Ce(),Ne=J[e],Z=i.scrollTop,{offsetTop:I,scrollHeight:Q}=Ne;I+Q>Z+i.clientHeight&&(i.scrollTop=I+Q-i.clientHeight),I<Z&&(i.scrollTop=I),s.value=e,(n=(t=c.value)==null?void 0:t.ref)==null||n.setAttribute("aria-activedescendant",`${k.value}-item-${s.value}`)},Ce=()=>{const e=U.value.querySelector(`.${u.be("suggestion","wrap")}`),t=e.querySelectorAll(`.${u.be("suggestion","list")} li`);return[e,t]},G=qe(H,()=>{var e;(e=N.value)!=null&&e.isFocusInsideContent()||h.value&&C()}),Se=e=>{switch(Ge(e)){case f.up:e.preventDefault(),b(s.value-1);break;case f.down:e.preventDefault(),b(s.value+1);break;case f.enter:case f.numpadEnter:e.preventDefault(),z();break;case f.tab:C();break;case f.esc:Ee(e);break;case f.home:e.preventDefault(),b(0);break;case f.end:e.preventDefault(),b(r.value.length-1);break;case f.pageUp:e.preventDefault(),b(Math.max(0,s.value-10));break;case f.pageDown:e.preventDefault(),b(Math.min(r.value.length-1,s.value+10));break}};return Be(()=>{G?.()}),_e(()=>{var e;const t=(e=c.value)==null?void 0:e.ref;t&&([{key:"role",value:"textbox"},{key:"aria-autocomplete",value:"list"},{key:"aria-controls",value:k.value},{key:"aria-activedescendant",value:`${k.value}-item-${s.value}`}].forEach(({key:n,value:i})=>t.setAttribute(n,i)),L=t.hasAttribute("readonly"))}),ne({highlightedIndex:s,activated:d,loading:y,inputRef:c,popperRef:N,suggestions:r,handleSelect:_,handleKeyEnter:z,focus:$e,blur:we,close:C,highlight:b,getData:j}),(e,t)=>(E(),Pe(a(Xe),{ref_key:"popperRef",ref:N,visible:h.value,placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[a(u).e("popper"),e.popperClass],"popper-style":e.popperStyle,teleported:e.teleported,"append-to":e.appendTo,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${a(u).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:de,onHide:ve},{content:g(()=>[X("div",{ref_key:"regionRef",ref:U,class:$([a(u).b("suggestion"),a(u).is("loading",q.value)]),style:Y({[e.fitInputWidth?"width":"minWidth"]:W.value,outline:"none"}),role:"region"},[e.$slots.header?(E(),S("div",{key:0,class:$(a(u).be("suggestion","header")),onClick:t[0]||(t[0]=ee(()=>{},["stop"]))},[m(e.$slots,"header")],2)):te("v-if",!0),T(a(Qe),{id:a(k),tag:"ul","wrap-class":a(u).be("suggestion","wrap"),"view-class":a(u).be("suggestion","list"),role:"listbox"},{default:g(()=>[q.value?(E(),S("li",ot,[m(e.$slots,"loading",{},()=>[T(a(je),{class:$(a(u).is("loading"))},{default:g(()=>[T(a(ze))]),_:1},8,["class"])])])):(E(!0),S(Ke,{key:1},Me(r.value,(n,i)=>(E(),S("li",{id:`${a(k)}-item-${i}`,key:i,class:$({highlighted:s.value===i}),role:"option","aria-selected":s.value===i,onClick:J=>_(n)},[m(e.$slots,"default",{item:n},()=>[Re(Ue(n[e.valueKey]),1)])],10,lt))),128))]),_:3},8,["id","wrap-class","view-class"]),e.$slots.footer?(E(),S("div",{key:1,class:$(a(u).be("suggestion","footer")),onClick:t[1]||(t[1]=ee(()=>{},["stop"]))},[m(e.$slots,"footer")],2)):te("v-if",!0)],6)]),default:g(()=>[X("div",{ref_key:"listboxRef",ref:H,class:$([a(u).b(),e.$attrs.class]),style:Y(pe.value),role:"combobox","aria-haspopup":"listbox","aria-expanded":h.value,"aria-owns":a(k)},[T(a(Ze),x({ref_key:"inputRef",ref:c},x(ue.value,e.$attrs),{"model-value":e.modelValue,disabled:a(R),onInput:ge,onChange:he,onFocus:be,onBlur:ye,onClear:ke,onKeydown:Se,onMousedown:me}),Oe({_:2},[e.$slots.prepend?{name:"prepend",fn:g(()=>[m(e.$slots,"prepend")]),key:"0"}:void 0,e.$slots.append?{name:"append",fn:g(()=>[m(e.$slots,"append")]),key:"1"}:void 0,e.$slots.prefix?{name:"prefix",fn:g(()=>[m(e.$slots,"prefix")]),key:"2"}:void 0,e.$slots.suffix?{name:"suffix",fn:g(()=>[m(e.$slots,"suffix")]),key:"3"}:void 0]),1040,["model-value","disabled"])],14,st)]),_:3},8,["visible","placement","popper-class","popper-style","teleported","append-to","transition"]))}});var rt=We(nt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/autocomplete/src/autocomplete.vue"]]);const mt=Je(rt);export{mt as E};
